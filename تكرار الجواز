# -.function onEdit(e) {
  const sheet = e.source.getActiveSheet();
  const range = e.range;
  const editedValues = range.getValues();

  // Ø¬Ù„Ø¨ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
  const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
  const passportColIndex = headers.indexOf("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø²");

  if (passportColIndex === -1) return;

  const allSheets = e.source.getSheets();
  const currentSheetName = sheet.getName();

  // Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„ Ø®Ù„ÙŠØ© ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§
  for (let i = 0; i < range.getNumRows(); i++) {
    for (let j = 0; j < range.getNumColumns(); j++) {
      const row = range.getRow() + i;
      const col = range.getColumn() + j;
      const editedValue = editedValues[i][j];

      if (row === 1 || col !== passportColIndex + 1 || !editedValue) continue;

      const normalizedValue = editedValue.toString().trim().toLowerCase();
      let duplicateFound = false;
      let duplicateLocation = "";

      // ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø£Ø®Ø±Ù‰
      for (let s = 0; s < allSheets.length; s++) {
        const otherSheet = allSheets[s];
        const otherName = otherSheet.getName();
        if (otherName === currentSheetName || otherName === "Ø§Ù„ÙˆØ±Ù‚Ø©6") continue;

        const otherHeaders = otherSheet.getRange(1, 1, 1, otherSheet.getLastColumn()).getValues()[0];
        const otherPassportIndex = otherHeaders.indexOf("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø²");
        if (otherPassportIndex === -1) continue;

        const data = otherSheet.getRange(2, otherPassportIndex + 1, otherSheet.getLastRow() - 1).getValues().flat();
        const normalizedData = data.map(v => v.toString().trim().toLowerCase());

        if (normalizedData.includes(normalizedValue)) {
          duplicateFound = true;
          duplicateLocation = otherName;
          break;
        }
      }

      // ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„ÙˆØ±Ù‚Ø©
      const currentData = sheet.getRange(2, passportColIndex + 1, sheet.getLastRow() - 1).getValues().flat();
      const normalizedCurrentData = currentData.map(v => v.toString().trim().toLowerCase());
      let duplicateInSameSheet = normalizedCurrentData.filter(v => v === normalizedValue).length > 1;

      const cell = sheet.getRange(row, col);

      // ğŸ–ï¸ Ø§Ù„ØªÙ„ÙˆÙŠÙ† ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡
      if (duplicateFound || duplicateInSameSheet) {
        cell.setBackground("#FFCDD2"); // Ø£Ø­Ù…Ø± ÙØ§ØªØ­
        let msg = "âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø² Ù…ÙƒØ±Ø± ";
        if (duplicateFound) msg += `ÙÙŠ ÙˆØ±Ù‚Ø©: ${duplicateLocation} `;
        if (duplicateInSameSheet) msg += `(Ø£Ùˆ Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„ÙˆØ±Ù‚Ø©)`;
        SpreadsheetApp.getActive().toast(msg, "ØªØ­Ø°ÙŠØ±", 6);
      } else {
        cell.setBackground(null); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ„ÙˆÙŠÙ†
      }
    }
  }
}
