function autoSendPreparationMessages() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const allSheets = ss.getSheets();

  allSheets.forEach(sheet => {
    const name = sheet.getName();
    if (name === "Ø§Ù„ÙˆØ±Ù‚Ø©6") return;

    const data = sheet.getDataRange().getValues();
    const headers = data[0];

    const phoneIndex = headers.indexOf("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„");
    const nameIndex = headers.indexOf("Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø¬ÙˆØ§Ø²");
    const statusIndex = headers.indexOf("Ø±Ø³Ø§Ù„Ø© Ø·Ù„Ø¨ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£ÙˆØ±Ø§Ù‚");

    if (phoneIndex === -1 || nameIndex === -1 || statusIndex === -1) return;

    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      const status = row[statusIndex];
      if (status) continue; // ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø£Ùˆ Ù…Ø­Ø§ÙˆÙ„Ø© Ø³Ø§Ø¨Ù‚Ø©

      let phone = row[phoneIndex]?.toString().trim().replace(/^0+/, "");
      if (!phone.startsWith("966")) phone = "966" + phone;
      const name = row[nameIndex] || "";

      const message = `ðŸ“Œ *Ù…ØªØ·Ù„Ø¨Ø§Øª ØªØ£Ø´ÙŠØ±Ø© Ø´Ù†ØºÙ† - ÙØ±Ù†Ø³Ø§ ðŸ‡«ðŸ‡·*\n\n` +
`Ù…Ø±Ø­Ø¨Ù‹Ø§ *${name}*ØŒ\n\n` +
`Ù†Ø±Ø¬Ùˆ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ø¨Ø¯Ø¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªØ£Ø´ÙŠØ±ØªÙƒ:\n\n` +
`1. ØµÙˆØ±ØªØ§Ù† Ø´Ø®ØµÙŠØ© Ø­Ø¯ÙŠØ«Ø© (4.5 Ã— 3.5) Ø¨Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡\n` +
`2. Ø£ØµÙ„ Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±\n` +
`3. ØµÙˆØ±Ø© Ù…Ù† ØªØ£Ø´ÙŠØ±Ø© Ø´Ù†ØºÙ† Ø³Ø§Ø¨Ù‚Ø© (Ø¥Ù† ÙˆØ¬Ø¯Øª)\n` +
`4. ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© / Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©\n` +
`5. Ø®Ø·Ø§Ø¨ ØªØ¹Ø±ÙŠÙ Ø¨Ø§Ù„Ø¹Ù…Ù„ (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©) ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:\n` +
`â€ƒ- Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ\n` +
`â€ƒ- Ø§Ù„Ø±Ø§ØªØ¨\n` +
`â€ƒ- ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚\n` +
`â€ƒ- Ù…ØµØ¯Ù‚ Ù…Ù† Ø§Ù„ØºØ±ÙØ© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©\n` +
`6. ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ Ù„Ø¢Ø®Ø± 4 Ø£Ø´Ù‡Ø±:\n` +
`â€ƒ- Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©\n` +
`â€ƒ- Ù…Ø®ØªÙˆÙ… ÙˆØµØ§Ø¯Ø± Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ù†Ùƒ\n` +
`7. Ø£Ù† Ù„Ø§ ÙŠÙ‚Ù„ Ø§Ù„Ø±ØµÙŠØ¯ Ø¹Ù† 10,000 Ø±ÙŠØ§Ù„\n` +
`8. Ù†Ø³Ø®Ø© Ù…Ù† ÙƒØ±Øª Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙØ± Ø¹Ø§Ø¦Ù„ÙŠ)\n\n` +
`ðŸ“© *ÙŠØ±Ø¬Ù‰ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ† Ù„ØªØ£ÙƒÙŠØ¯ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¨ØµÙ…Ø©.*\n\n` +
`âš ï¸ Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¢Ù„ÙŠØ© ÙˆÙ„Ø§ ÙŠØ¬Ø¨ Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§.`


      const body = {
        number: phone,
        text: message
      };

      const options = {
        method: 'post',
        contentType: 'application/json',
        headers: {
          'apikey': '878559AC4207-4520-A544-80D3FEB9ED9B'
        },
        payload: JSON.stringify(body),
        muteHttpExceptions: true
      };

      try {
        const response = UrlFetchApp.fetch("https://w.eh4.me/message/sendText/ABD1", options);
        const json = JSON.parse(response.getContentText());

        Logger.log(`ðŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰: ${phone}\nØ§Ù„Ø§Ø³Ù…: ${name}\nØ§Ù„Ù†ØªÙŠØ¬Ø©: ${json.status}`);

        if (json.status === "PENDING" || json.status === "success") {
          sheet.getRange(i + 1, statusIndex + 1).setValue("âœ…");
        } else {
          sheet.getRange(i + 1, statusIndex + 1).setValue("âŒ");
        }
      } catch (err) {
        Logger.log(`âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰: ${phone} | Ø§Ù„Ø®Ø·Ø£: ${err.message}`);
        sheet.getRange(i + 1, statusIndex + 1).setValue("âŒ");
      }
    }
  });
}
