function sendConfirmationToAllSheets() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const allSheets = ss.getSheets();

  const instanceId = "6795E5298DEC5";
  const accessToken = "66f85a4411dc4";

  allSheets.forEach(sheet => {
    const sheetName = sheet.getName();
    if (sheetName === "Ø§Ù„ÙˆØ±Ù‚Ø©6") return;

    const data = sheet.getDataRange().getValues();
    const headers = data[0];

    const phoneIndex = headers.indexOf("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„");
    const statusIndex = headers.indexOf("Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²");
    const nameIndex = headers.indexOf("Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø¬ÙˆØ§Ø²");

    if (phoneIndex === -1 || statusIndex === -1) return;

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ù‚Ø©
    const dateMatch = sheetName.match(/^(\d+)([A-Z]{3})/);
    let visaDate = "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    if (dateMatch) {
      const day = dateMatch[1];
      const monthEng = dateMatch[2];
      const monthMap = {
        JAN: "ÙŠÙ†Ø§ÙŠØ±",
        FEB: "ÙØ¨Ø±Ø§ÙŠØ±",
        MAR: "Ù…Ø§Ø±Ø³",
        APR: "Ø£Ø¨Ø±ÙŠÙ„",
        MAY: "Ù…Ø§ÙŠÙˆ",
        JUN: "ÙŠÙˆÙ†ÙŠÙˆ",
        JUL: "ÙŠÙˆÙ„ÙŠÙˆ",
        AUG: "Ø£ØºØ³Ø·Ø³",
        SEP: "Ø³Ø¨ØªÙ…Ø¨Ø±",
        OCT: "Ø£ÙƒØªÙˆØ¨Ø±",
        NOV: "Ù†ÙˆÙÙ…Ø¨Ø±",
        DEC: "Ø¯ÙŠØ³Ù…Ø¨Ø±"
      };
      visaDate = `*${day} ${monthMap[monthEng] || monthEng}*`;
    }

    for (let i = 1; i < data.length; i++) {
      let phone = data[i][phoneIndex];
      const status = data[i][statusIndex];
      const name = nameIndex !== -1 ? data[i][nameIndex] : "";

      if (!phone || status === "âœ…") continue;

      phone = phone.toString().trim().replace(/^0+/, "");
      if (!phone.startsWith("966")) phone = "966" + phone;

     const message =
  `ğŸ“Œ Ù…Ø±Ø­Ø¨Ù‹Ø§ *${name || ""}*ØŒ\n` +
  `ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„Ø´Ù†ØºÙ† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø¨ØªØ§Ø±ÙŠØ® ${visaDate}.\n\n` +
  `Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©.\n` +
  `âš ï¸ Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¢Ù„ÙŠØ© ÙˆÙ„Ø§ ÙŠØ¬Ø¨ Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§.`;


      const url = `https://app.arrivewhats.com/api/send?number=${phone}&type=text&message=${encodeURIComponent(message)}&instance_id=${instanceId}&access_token=${accessToken}`;

      try {
        const response = UrlFetchApp.fetch(url, { method: "get" });
        const json = JSON.parse(response.getContentText());

        if (json.status === "success") {
          sheet.getRange(i + 1, statusIndex + 1).setValue("âœ…");
        } else {
          sheet.getRange(i + 1, statusIndex + 1).setValue("âŒ");
        }
      } catch (err) {
        sheet.getRange(i + 1, statusIndex + 1).setValue("âŒ");
      }
    }
  });
}
